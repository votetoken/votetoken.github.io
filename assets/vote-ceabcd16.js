import{m as v,r as M,a as I,f as c,d as g,e as C,b as N,h as R}from"./chunk-OKULXQAF-3a8acbcc.js";import{r as d,i as A,g as D,I as B,J as h,D as x}from"./index-e4d6fab6.js";const l=[{inputs:[{internalType:"uint256",name:"roundId",type:"uint256"}],name:"claim",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"currentRoundId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentRound",outputs:[{components:[{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"uint256",name:"rewardsPerUser",type:"uint256"},{components:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"logo",type:"string"},{internalType:"uint256",name:"votesCount",type:"uint256"}],internalType:"struct VoteCoin.RoundItemDescription",name:"itemA",type:"tuple"},{components:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"logo",type:"string"},{internalType:"uint256",name:"votesCount",type:"uint256"}],internalType:"struct VoteCoin.RoundItemDescription",name:"itemB",type:"tuple"}],internalType:"struct VoteCoin.Round",name:"round",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"roundId",type:"uint256"}],name:"getRound",outputs:[{components:[{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"uint256",name:"rewardsPerUser",type:"uint256"},{components:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"logo",type:"string"},{internalType:"uint256",name:"votesCount",type:"uint256"}],internalType:"struct VoteCoin.RoundItemDescription",name:"itemA",type:"tuple"},{components:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"logo",type:"string"},{internalType:"uint256",name:"votesCount",type:"uint256"}],internalType:"struct VoteCoin.RoundItemDescription",name:"itemB",type:"tuple"}],internalType:"struct VoteCoin.Round",name:"round",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"roundId",type:"uint256"},{internalType:"address",name:"user",type:"address"}],name:"getVote",outputs:[{components:[{internalType:"enum VoteCoin.RoundItem",name:"item",type:"uint8"},{internalType:"uint256",name:"earned",type:"uint256"},{internalType:"uint256",name:"claimedAt",type:"uint256"},{internalType:"uint256",name:"createdAt",type:"uint256"}],internalType:"struct VoteCoin.Vote",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getVoteOfCurrentRound",outputs:[{components:[{internalType:"enum VoteCoin.RoundItem",name:"item",type:"uint8"},{internalType:"uint256",name:"earned",type:"uint256"},{internalType:"uint256",name:"claimedAt",type:"uint256"},{internalType:"uint256",name:"createdAt",type:"uint256"}],internalType:"struct VoteCoin.Vote",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"roundId",type:"uint256"},{internalType:"address",name:"user",type:"address"}],name:"isClaimed",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"roundId",type:"uint256"}],name:"isInVoteTime",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"isQualifiedToVote",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"roundId",type:"uint256"},{internalType:"address",name:"user",type:"address"}],name:"isVoted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"minimumBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"rewardType",outputs:[{internalType:"enum VoteCoin.RewardType",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"rewardsPool",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"token",outputs:[{internalType:"contract IERC20Metadata",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"enum VoteCoin.RoundItem",name:"item",type:"uint8"}],name:"vote",outputs:[],stateMutability:"nonpayable",type:"function"}],P=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{constant:!0,inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"}],f=new Map;async function S(e){if(f.has(e))return f.get(e);const t={address:e,abi:P},[n,i,a]=await v({allowFailure:!1,contracts:["name","symbol","decimals"].map(u=>({...t,functionName:u}))}),s={address:e,name:n,symbol:i,decimals:a};return f.set(e,s),s}function y(){return"0xf913911b0cd39Ae9cDc37514439b41C3cbC28Da6"}async function k(){return Number(await M({address:y(),abi:l,functionName:"currentRoundId"}))}async function F(e){if(e<0)return;const n={address:y(),abi:l},i=await v({allowFailure:!1,contracts:[{...n,functionName:"currentRoundId"},{...n,functionName:"decimals"},{...n,functionName:"getRound",args:[e]},{...n,functionName:"minimumBalance"},{...n,functionName:"rewardType"},{...n,functionName:"rewardsPool"},{...n,functionName:"token"}]}),a=i[2];if(!a.itemA.logo||!a.itemB.logo)return;const s=i[4],u=await S(String(i[6]));let o=u.symbol;return s==1&&(o=I().chain.nativeCurrency.symbol),a.itemA.votesCount=Number(a.itemA.votesCount),a.itemB.votesCount=Number(a.itemB.votesCount),{id:e,currentRoundId:Number(i[0]),decimals:Number(i[1]),startAt:new Date(Number(a.startTime)*1e3),endAt:new Date(Number(a.endTime)*1e3),rewardsType:s,rewardsPool:c(BigInt(String(i[5])),Number(i[1])),rewardsPerUser:c(a.rewardsPerUser,Number(i[1])),minimumContribute:c(BigInt(String(i[3])),Number(i[1])),token:u,items:[a.itemA,a.itemB],rewardsSymbol:o}}async function j(e){const t=y(),{hash:n}=await g({address:t,abi:l,functionName:"vote",args:[e]});return await C({hash:n}),!0}async function q(e){const t=y(),{hash:n}=await g({address:t,abi:l,functionName:"claim",args:[e]});return await C({hash:n}),!0}async function U(e,t){const i={address:y(),abi:l},a=await v({allowFailure:!1,contracts:[{...i,functionName:"getVote",args:[e.id,t]},{...i,functionName:"isClaimed",args:[e.id,t]},{...i,functionName:"isQualifiedToVote",args:[t]},{...i,functionName:"isVoted",args:[e.id,t]}]}),s=a[1],u=a[2],o=a[3],m=!s&&!o&&u;let p;if(o){const r=a[0];p={votedItem:r.item,votedAt:new Date(Number(r.createdAt)*1e3),claimedAt:s?new Date(Number(r.claimedAt)*1e3):void 0,claimedValue:c(r.earned,e.decimals)}}return{votable:m,isVoted:o,isClaimed:s,vote:p}}function T(e){return B()?(h(e),!0):!1}function O(e){return typeof e=="function"?e():x(e)}const w=typeof window<"u",z=()=>+Date.now(),G=()=>{};function H(e,t=1e3,n={}){const{immediate:i=!0,immediateCallback:a=!1}=n;let s=null;const u=d(!1);function o(){s&&(clearInterval(s),s=null)}function m(){u.value=!1,o()}function p(){const r=O(t);r<=0||(u.value=!0,a&&e(),o(),s=setInterval(e,r))}if(i&&w&&p(),A(t)||typeof t=="function"){const r=D(t,()=>{u.value&&w&&p()});T(r)}return T(m),{isActive:u,pause:m,resume:p}}function Q(){const e=d(N()),t=R(n=>{e.value=n});return T(()=>t()),e}const V=d(),b=d();async function E(){V.value=await F(await k())}async function J(e,t){var n;if(!(e!=null&&e.value)||!((n=t==null?void 0:t.value)!=null&&n.address))return b.value=void 0;b.value=await U(e.value,t.value.address)}function W(){return{round:V,update:E}}function K(){const{round:e}=W(),t=Q();return{vote:b,update:()=>J(e,t)}}export{T as a,Q as b,q as c,U as d,W as e,K as f,F as g,w as i,G as n,z as t,H as u,j as v};
